# Решение Задания

## Part 1. Установка ОС

- Просмотр версии ОС с помощью команды: 

![version OS](/src/photo/version_OS.jpg)

## Part 2. Создание пользователя

- Создам нового пользователя с помощью команды `sudo adduser newuser`, добавлю его в группу `sudo usermod -a -G adm new_user` и сразу проверю его через `cat /etc/passwd`

![add new user](/src/photo/add_us.jpg)

## Part 3. Настройка сети ОС

- Зададим новое название хоста: user-1; с помощью команды: `sudo hostname user-1`

![hostname](/src/photo/hostname.jpg)

- Чтобы узнать какая временная зона установлена на данный момент можно воспользоаться командой: `date`. Для изменения часового пояса на Europe/Moscow, используем команду: `sudo timedatectl set-timezone Europe/Moscow`

![date](/src/photo/date.jpg)

*На фото показано сразу верное время, можно посмотреть как через `date`, так и через `timedatectl show`*

- Вывести названия сетевых интерфейсов можно тремы консольными команда:
    `ip l`
    `ip address`
    `ls /sys/class/net`
![ip l](/src/photo/ip_l.jpg)

*Loopback(lo), обозначаемый как lo в большинстве систем Linux, является специальным сетевым интерфейсом, который используется для коммуникации между процессами на одной и той же машине. Он служит своего рода "внутренним" сетевым интерфейсом, позволяя программам отправлять и получать данные, как будто они находятся в разных сетевых адресах внутри одного компьютера.*

- Чтобы узнать IP-адрес, выданный DHCP сервером воспользуемся командой: `cat /var/log/syslog | grep -i dhcp`

![ctvrlgsslggrpidhcp](/src/photo/catvarlogsysloggrepidhcp.jpg)

*DHCP (Dynamic Host Configuration Protocol) является сетевым протоколом, который обеспечивает динамическую конфигурацию IP-адресов и других сетевых параметров для устройств в сети TCP/IP. Этот протокол функционирует на основе клиент-серверской модели. При инициализации сетевого подключения, клиентское устройство автоматически обращается к DHCP-серверу для получения необходимых сетевых параметров, включая IP-адрес. Таким образом, DHCP упрощает процесс настройки сетевых устройств, позволяя им получать актуальные сетевые параметры без ручной конфигурации.*

- Чтобы вывести внешний IP-адрес шлюза есть команда: `curl ifconfig.co`

![curl ifconfig](/src/photo/curlifconfigco.jpg)

- Вывести на экран внутренний IP-адрес шлюза, он же IP-адрес по умолчанию (gw), есть команды: `ip route` и `route -n`

![ip route](/src/photo/iproute.jpg)

- *Внешний IP-адрес шлюза: 95.26.76.95;*
- *Внутренний IP-адрес шлюза: 192.168.0.1.*

- Зададим статичные статичные (заданные вручную, а не полученные от DHCP сервера) настройки IP, gw, dns (используй публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).

![table](/src/photo/etcnetplan00installerconfigyaml.jpg)

*Команда: `sudo nano /etc/netplan/00-installer-config.yaml`*

- Пропингуем удаленные хосты 1.1.1.1 и ya.ru

![ping](/src/photo/ping1111yaru.jpg)

## Part 4. Обновление ОС

- Обновить все системные пакеты можно командой `sudo apt-get upgrade`

![sudo apt-get upgrade](/src/photo/sudoaptgetupgrade.jpg)

## Part 5. Использование команды sudo

- Разрешиv пользователю, созданному в Part 2, выполнять команду sudo командой `sudo usermod -a -G sudo new_user` и сразу проверить это командой `groups new_user`

![sudo usermod -a -G sudo new_user](/src/photo/sudonewuserag.jpg)

- Переключусь между пользователями через команду `su` и поменяю имя хоста через команду `sudo hostnamectl set-hostname user-2`

![sudo hostnamectl set-hostname user-2](/src/photo/sudonewuser2host.jpg)

*Sudo: Команда `sudo` в операционных системах на базе `Unix` и `Linux` играет ключевую роль в управлении доступом к ресурсам системы. Она позволяет пользователю выполнять действия с привилегиями другого пользователя, обычно суперпользователя `(root)`, без необходимости переходить под этот аккаунт. Это значительно упрощает работу с системой, особенно когда необходимо выполнить операции, требующие повышенных прав, например, установку нового программного обеспечения или изменение системных файлов.*

## Part 6. Установка и настройка службы времени

- С помощью команд `date` и `timedatectl show` выведем текущее время часового пояса, в котором мы находимся и вывод настроек часового пояса

![timedatectl show](/src/photo/timedatectlshow.jpg)
 
 *Запись `NTPSynchronized=yes` свидетельствует о том, что протокол NTP (сетевой протокол времени) активен. NTP - это протокол, отвечающий за синхронизацию времени компьютера со стандартными эталонными часами через интернет с помощью иерархии серверов NTP*

## Part 7. Установка и использование текстовых редакторов

- Для установки текстовых редакторов есть командамы `sudo apt install vim` `sudo apt install nano` `sudo apt install mc` `sudo apt install joe`

- Всё для Vim: 1. Чтобы открыть и записать что-то: `vim vim.txt` после в самом редакторе нажать `i` *insert* 2. Чтобы закрыть и сохранить жмём `Esc` + `:wq`, что значит write and quit. 3. Для выхода без изменений `Esc` + `:q!` 4. Поиск: `ESC` + `/<слово>` 5. Замена: `Esc` + `:s/<что меняем>/<на что меняем>`

![vim vim.txt](/src/photo/vimtxt.jpg)

![Esc + :wq](/src/photo/eskq.jpg)

![Esc + :q!](/src/photo/catvimtxt.jpg)

![ESC + /<слово>](/src/photo/squanclovim.jpg)

![Esc + :s/<что меняем>/<на что меняем>](/src/photo/ssquanclohome.jpg)

- Всё для nano: 1. Чтобы открыть и записать что-то: `nano nano.txt` 2. Чтобы закрыть и сохранить жмём `Ctrl + S` + `Ctrl + X` 3. Для выхода без изменений `Ctrl + X` + `N` 4. Поиск: `Ctrl + W` 5. Замена: `Ctrl + \`

![nano nano.txt](/src/photo/nanotxt.jpg)

![Ctrl + S + Ctrl + X](/src/photo/nanoschool.jpg)

![Ctrl + N](/src/photo/catnano.jpg)

![Ctrl + W](/src/photo/nanosearch.jpg)

![Ctrl + slsh](/src/photo/nanorepl.jpg)

- Всё для mcedit: 1. Чтобы открыть и записать что-то: `mcedit mcedit.txt` 2. Чтобы закрыть и сохранить жмём `F10` + `Yes` 3. Для выхода без изменений `F10` + `No` 4. Поиск: `F7` 5. Замена: `F4`

![mcedit mcedit.txt](/src/photo/mcedittxt.png)

![F10 + Yes](/src/photo/mceditschool.jpg)

![F10 + No](/src/photo/catmcedit.jpg)

![F7](/src/photo/mceditf7.jpg)

![F4](/src/photo/mceditf4.jpg)

## Part 8. Установка и базовая настройка сервиса SSHD

- Установим утилиту SSHd командой `sudo apt install openssh-server` и узнаем статус SSHd службы, командой `sudo systemctl status ssh`

![sudo systemctl status ssh](/src/photo/sshdis.jpg)

- Установим статус enable командой `sudo systemctl enable ssh`

![sudo systemctl enable ssh](/src/photo/sshenb.jpg)

- Перенастроим службы SSHd на порт 2022 через файл sshd_config командой `sudo nano /etc/ssh/sshd_config`

![sudo nano /etc/ssh/sshd_config](/src/photo/port2022.jpg)

- Чтобы сохранить изменения есть команда `sudo systemctl restart ssh` и проверить `sudo systemctl status ssh`, но стоит настроить брандмауэр, так как мы изменили SSH-порт по умолчанию на 2022, командой `sudo ufw allow ssh` и `sudo ufw allow 2022/tcp`

![sudo ufw allow ssh](/src/photo/sshallow.jpg)

- Наличие процесса sshd, можно проверить командой `ps aux | grep -i ssh`

![grep ssh1](/src/photo/sshgrep1.jpg)

*`ps aux` используется для отображения всех процессов всех пользователей, кроме фоновых. Опция aux включает в себя:
`a` — показывать процессы всех пользователей;
`u` — отображать информацию о процессах в ориентированном на пользователя формате;
`x` — включать процессы без управляющего терминала, что позволяет видеть многие системные и демонские процессы.
`--no-fraction` (или `-f`) используется для предотвращения вывода процентного соотношения использования CPU процессами. Это делает вывод более читаемым, особенно когда используется вместе с grep.
| (pipe) используется для перенаправления вывода первой команды (`ps aux`) на ввод второй команды (`grep -i ssh`).
grep -i ssh фильтрует вывод, оставляя только те строки, которые содержат "ssh" (независимо от регистра благодаря флагу `-i`), игнорируя остальные строки.*

- Отображения активные сетевые соединений через `netstat -tan`

![grep ssh](/src/photo/grepssh.jpg)

 *Команда netstat -tan предоставляет детальную информацию о сетевых соединениях и прослушиваемых портах в системе. Вот более подробное описание каждого элемента вывода:

`-a` - Вывод всех активных подключений TCP и прослушиваемых компьютером портов TCP и UDP.
`-n` - Вывод активных подключений TCP с отображением адресов и номеров портов в числовом формате без попыток

Proto: Указывает на используемый сетевой протокол (TCP или UDP).
Recv-Q: Отображает количество данных, полученных сетью и ожидаемых приложением, но еще не прочитанных. Это может помочь выявить проблемы с приложениями, которые должны обрабатывать входящий трафик.
Send-Q: Показывает количество данных, готовых к отправке через сеть, но еще не отправленных. Высокие значения могут указывать на проблемы с сетевым трафиком или перегрузку сервера.
Local Address: Локальный сетевой адрес и порт, на которых сервер принимает входящие соединения. В случае прослушивания портов, это может быть адрес 0.0.0.0, что означает прием соединений с любого внешнего адреса.
Foreign Address: Адрес и порт удаленного хоста, с которого было установлено соединение. В контексте прослушивания портов, это может также быть 0.0.0.0:*, что означает возможность подключения с любого внешнего адреса и порта.
State: Стадия сетевого соединения или состояния прослушивания порта. Это может включать различные значения, такие как LISTEN (порт прослушивается), ESTABLISHED (соединение активно), TIME_WAIT (соединение закрыто и ожидает завершения таймаута), и другие.
Эта команда позволяет администраторам систем и сетевым инженерам быстро оценить текущее состояние сетевых соединений и определить возможные проблемы с сетевой инфраструктурой или приложениями, использующими сетевые ресурсы.*

## Part 9. Установка и использование утилит top, htop

- Команда `top` делает следующее 

![top](/src/photo/top.jpg)

1. Uptime - 59 минут;
2. Количество авторизованных пользователей - 1;
3. Общую загрузку системы - 0.01;
4. Общее количество процессов - 106;
5. Загрузка cpu - 0.0 %;
6. Загрузка памяти - 465.3 из 2546.2;
7. Pid процесса занимающего больше всего памяти - 1, 0.5%;
8. Pid процесса, занимающего больше всего процессорного времени - 11919 и 11835
9. Pid 1

- Вызов `htop`

![htop](/src/photo/htop.jpg)

- Для сортировки `htop` разделов нужно нажать `F6` и выбрать параметр, поставил Pid

![htop pid](/src/photo/htoppid.jpg)

- Отсортированный по PERCENT_CPU

![htop CPU](/src/photo/pidCPU.jpg)

- Отсортированный по PERCENT_MEM

![htop MEM](/src/photo/htopmem.jpg)

- Отсортированный по TIME

![htop TIME](/src/photo/htoptime.jpg)

- Фильтрация делается через `F4` поставил `sshd`

![htop sshd](/src/photo/htopsshd.jpg)

- Поиск через `F3`, ввёл `syslog`

![htop syslog](/src/photo/htopsyslog.jpg)

- Чтобы добавить доп. параметры нужно выбрать их в меню через `F2`, добавил hostname, clock и uptime

![htop hostname, clock и uptime](/src/photo/htopfinal.jpg)

## Part 10. Использование утилиты fdisk

- Запуск команды `sudo fdisk -l`

![fdisk -l](/src/photo/fdiskl.jpg)

*Название жесткого диска: VBOX HARDDISK (/dev/sda)*
*Размер диска: 25 Гигабайт;*
*Количество секторов: 52428800;*

- Узнать размер swap можно командной `free -h`

![free -h](/src/photo/freeh.jpg)

*Размер swap: 2401276 кб или 2.401 гб;*

## Part 11. Использование утилиты df

- Вывод команды `df /`

![df /](/src/photo/df.jpg)

*Для корневого раздела (/):*
*- Размер раздела: 11758760;*
*- Размер занятого пространства: 4772396;*
*- Размер свободного пространства: 6367256;*
*- Процент использования: 43 %;*
*Единицы измерения при выводе: Килобайты*

- Вывод команды `df -Th`

![df -Th](/src/photo/dfth.jpg)

*Для корневого раздела (/):*
*- Размер раздела: 12 гб;*
*- Размер занятого пространства: 4.6 гб;*
*- Размер свободного пространства: 6.1 гб;*
*- Процент использования: 43 %;*
*Единицы измерения при выводе: Гигабайты*

## Part 12. Использование утилиты du

- Вывод команды `du`

![du](/src/photo/du.jpg)

- Вывод размера папки /home командами `sudo du -s /home/` и `sudo du -sh /home/`

![sudo du -sh /home/](/src/photo/duhome.jpg)

- Вывод размера папки /var командами `sudo du -s /var/` и `sudo du -sh /var/`

![sudo du -s /var/](/src/photo/duvar.jpg)

- Вывод размера папки /var/log командами `sudo du -s /var/log/` и `sudo du -sh /var/log/`

![sudo du -s /var/log/](/src/photo/duvarlog.jpg)

- Вывод размера всего содержимого папки /var/log командами `sudo du /var/log/` и `sudo du -h /var/log/`

![sudo du /var/log/](/src/photo/duvarlogh.jpg)

- Вывод размера каждого вложенного элемента папки /var/log командой `sudo du /var/log/* | less` 

![sudo du /var/log/* | less](/src/photo/duless.jpg)

## Part 13. Установка и использование утилиты ncdu

- Установим `ncdu` командой `sudo apt install ncdu`

![sudo apt install ncdu](/src/photo/aptncdu.jpg)

- Выведем размер папки командой `ncdu /home`

![ncdu home](/src/photo/ncduhome.jpg)

- Выведем размер папки командой `ncdu /var`

![ncdu var](/src/photo/ncduvar.jpg)

- Выведем размер папки командой `ncdu /var/log`

![ncdu var log](/src/photo/ncduvarlog.jpg)

## Part 14. Работа с системными журналами

- Файл /var/log/dmesg в Linux системах собирает и хранит сообщения от ядра системы, включая информацию о загрузке и инициализации аппаратного обеспечения. Этот файл служит важным источником данных для диагностики проблем с оборудованием и драйверами устройств. Сообщения в /var/log/dmesg появляются начиная с момента загрузки системы и продолжают накапливаться по мере работы системы. Когда размер файла достигает определенного предела, самые старые записи удаляются, освобождая место для новых сообщений. Выведу его через команду `less /var/log/dmesg`

![less /var/log/dmesg](/src/photo/lessvarlog.jpg)

- Файл /var/log/syslog содержит глобальный системный журнал, в котором пишутся сообщения с момента запуска системы, от ядра Linux, различных служб, обнаруженных устройствах, сетевых интерфейсов и много другого. Выведу его через команду `less /var/log/syslog`

![less /var/log/syslog](/src/photo/lesssyslog.jpg)

- Файл /var/log/auth.log содержит информацию об авторизации пользователей, включая удачные и неудачные попытки входа в систему, а также задействованные механизмы аутентификации. Выведу его через команду `less /var/log/auth.log`

![less /var/log/auth.log](/src/photo/lessauthlog.jpg)

*Время последней успешной авторизации: 2024-08-23, 18:45:39*
*Имя пользователя: stepan*
*Метод входа в систему: by uid = 0 (User Identifier). Суперпользователь всегда должен иметь UID, равный нулю (0).*

- Перезапустим службу SSHd с командой `sudo systemctl restart ssh`

![sudo systemctl restart ssh](/src/photo/1234.jpg)

## Part 15. Использование планировщика заданий CRON

- Откроем планировщик заданий CRON через nano командой `crontab -e`+ `1`

![cron nano](/src/photo/cronnano.jpg)

*Добавил строчку */2 * * * * uptime, чтобы команда uptime запускалась через каждые 2 минуты*

- Запустим команду `less /var/log/syslog | grep CRON` чтобы посмотреть, как работуют изменения

![less /var/log/syslog | grep CRON](/src/photo/grepcron.jpg)

- Чтобы вывести список текущих заданий для CRON есть команда `crontab -l`

![crontab -l](/src/photo/cronl.jpg)

- Удалить все задания из планировщика можно командой `crontab -r`

![crontab -r](/src/photo/cronr.jpg)